!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("React"),require("moment"),require("d3")):"function"==typeof define&&define.amd?define(["React","moment","d3"],e):"object"==typeof exports?exports.CalendarHeatmap=e(require("React"),require("moment"),require("d3")):t.CalendarHeatmap=e(t.React,t.moment,t.d3)}(this,function(t,e,i){return function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),a=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default=a.default,t.exports=e.default},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(2),d=n(l),u=i(3),c=n(u),h=i(4),f=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(h),p=function(t){function e(t){a(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.settings={gutter:5,item_gutter:1,width:1e3,height:200,item_size:10,label_padding:40,max_block_height:20,transition_duration:500,tooltip_width:250,tooltip_padding:15},i.in_transition=!1,i.overview=i.props.overview,i.history=["global"],i.selected={},i.calcDimensions=i.calcDimensions.bind(i),i}return r(e,t),o(e,[{key:"componentDidMount",value:function(){this.createElements(),this.parseData(),this.drawChart(),window.addEventListener("resize",this.calcDimensions)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.calcDimensions)}},{key:"createElements",value:function(){this.svg=f.select("#calendar-heatmap").append("svg").attr("class","svg"),this.items=this.svg.append("g"),this.labels=this.svg.append("g"),this.buttons=this.svg.append("g"),this.tooltip=f.select("#calendar-heatmap").append("div").attr("class","heatmap-tooltip").style("opacity",0).style("pointer-events","none").style("position","absolute").style("z-index",9999).style("width","250px").style("max-width","250px").style("overflow","hidden").style("padding","15px").style("font-size","12px").style("line-height","14px").style("color","rgb(51, 51, 51)").style("background","rgba(255, 255, 255, 0.75)"),this.calcDimensions()}},{key:"calcDimensions",value:function(){var t=Math.round(((0,c.default)()-(0,c.default)().subtract(1,"year").startOf("week"))/864e5),e=Math.trunc(t/7),i=e+1;this.settings.width=this.container.offsetWidth<1e3?1e3:this.container.offsetWidth,this.settings.item_size=(this.settings.width-this.settings.label_padding)/i-this.settings.gutter,this.settings.height=this.settings.label_padding+7*(this.settings.item_size+this.settings.gutter),this.svg.attr("width",this.settings.width).attr("height",this.settings.height),this.props.data&&this.props.data[0].summary&&this.drawChart()}},{key:"parseData",value:function(){this.props.data&&(this.props.data[0].summary||this.props.data.map(function(t){var e=t.details.reduce(function(t,e){return t[e.name]?t[e.name].value+=e.value:t[e.name]={value:e.value},t},{}),i=Object.keys(e).map(function(t){return{name:t,value:e[t].value}});return t.summary=i.sort(function(t,e){return e.value-t.value}),t}))}},{key:"drawChart",value:function(){"global"===this.overview?this.drawGlobalOverview():"year"===this.overview?this.drawYearOverview():"month"===this.overview?this.drawMonthOverview():"week"===this.overview?this.drawWeekOverview():"day"===this.overview&&this.drawDayOverview()}},{key:"drawGlobalOverview",value:function(){var t=this;this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview);var e=(0,c.default)(this.props.data[0].date).startOf("year"),i=(0,c.default)(this.props.data[this.props.data.length-1].date).endOf("year"),n=f.timeYears(e,i).map(function(e){var i=(0,c.default)(e);return{date:i,total:t.props.data.reduce(function(t,e){return(0,c.default)(e.date).year()===i.year()&&(t+=e.total),t},0),summary:function(){var e=t.props.data.reduce(function(t,e){return(0,c.default)(e.date).year()===i.year()&&e.summary.map(function(e){t[e.name]?t[e.name].value+=e.value:t[e.name]={value:e.value}}),t},{});return Object.keys(e).map(function(t){return{name:t,value:e[t].value}}).sort(function(t,e){return e.value-t.value})}()}}),a=f.max(n,function(t){return t.total}),s=f.timeYears(e,i).map(function(t){return(0,c.default)(t)}),r=f.scaleBand().rangeRound([0,this.settings.width]).padding([.05]).domain(s.map(function(t){return t.year()}));this.items.selectAll(".item-block-year").remove();this.items.selectAll(".item-block-year").data(n).enter().append("rect").attr("class","item item-block-year").style("cursor","pointer").attr("width",function(){return(t.settings.width-t.settings.label_padding)/s.length-5*t.settings.gutter}).attr("height",function(){return t.settings.height-t.settings.label_padding}).attr("transform",function(e){return"translate("+r(e.date.year())+","+2*t.settings.tooltip_padding+")"}).attr("fill",function(e){return f.scaleLinear().range(["#ffffff",t.props.color]).domain([-.15*a,a])(e.total)||"#ff4500"}).on("click",function(e){t.in_transition||(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeGlobalOverview(),t.overview="year",t.drawChart())}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var i="";i+='<div><span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><strong>Total time tracked:</strong></span>';var n=parseInt(e.total,10),a=Math.floor(n/86400);a>0&&(i+='<span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(1===a?"1 day":a+" days")+"</span></div>");var s=Math.floor((n-86400*a)/3600);s>0&&(i+=a>0?'<div><span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></span><span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(1===s?"1 hour":s+" hours")+"</span></div>":'<span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(1===s?"1 hour":s+" hours")+"</span></div>");var o=Math.floor((n-86400*a-3600*s)/60);if(o>0&&(i+=a>0||s>0?'<div><span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></span><span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(1===o?"1 minute":o+" minutes")+"</span></div>":'<span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(1===o?"1 minute":o+" minutes")+"</span></div>"),i+="<br />",e.summary.length<=5)for(var l=0;l<e.summary.length;)i+='<div><span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><strong>'+e.summary[l].name+"</strong></span>",i+="<span>"+t.formatTime(e.summary[l].value)+"</span></div>",l++;else{for(var d=0;d<5;)i+='<div><span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><strong>'+e.summary[d].name+"</strong></span>",i+='<span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+t.formatTime(e.summary[d].value)+"</span></div>",d++;i+="<br />",d=5;for(var u=0;d<e.summary.length;)u=+e.summary[d].value,d++;i+='<div><span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><strong>Other:</strong></span>',i+='<span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+t.formatTime(u)+"</span></div>"}for(var c=r(e.date.year())+2*t.settings.tooltip_padding;t.settings.width-c<t.settings.tooltip_width+5*t.settings.tooltip_padding;)c-=10;var h=3*t.settings.tooltip_padding;t.tooltip.html(i).style("left",c+"px").style("top",h+"px").transition().duration(t.settings.transition_duration/2).ease(f.easeLinear).style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).transition().delay(function(e,i){return t.settings.transition_duration*(i+1)/10}).duration(function(){return t.settings.transition_duration}).ease(f.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var i=0;t.each(function(){++i}).on("end",function(){--i||e.apply(this,arguments)})},function(){t.in_transition=!1});this.labels.selectAll(".label-year").remove(),this.labels.selectAll(".label-year").data(s).enter().append("text").attr("class","label label-year").style("cursor","pointer").style("fill","rgb(170, 170, 170)").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return t.year()}).attr("x",function(t){return r(t.year())}).attr("y",this.settings.label_padding/2).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block-year").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).year()===e.year()?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-year").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",1)}).on("click",function(e){t.in_transition||(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeGlobalOverview(),t.overview="year",t.drawChart())})}},{key:"drawYearOverview",value:function(){var t=this;this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview);var e=(0,c.default)(this.selected.date).startOf("year"),i=(0,c.default)(this.selected.date).endOf("year"),n=this.props.data.filter(function(t){return e<=(0,c.default)(t.date)&&(0,c.default)(t.date)<i}),a=f.max(n,function(t){return t.total}),s=f.scaleLinear().range(["#ffffff",this.props.color]).domain([-.15*a,a]),r=function(i){var n=(0,c.default)(i.date),a=Math.round((n-(0,c.default)(e).startOf("week"))/864e5);return Math.trunc(a/7)*(t.settings.item_size+t.settings.gutter)+t.settings.label_padding},o=function(e){return t.settings.label_padding+(0,c.default)(e.date).weekday()*(t.settings.item_size+t.settings.gutter)},l=function(e){return a<=0?t.settings.item_size:.75*t.settings.item_size+t.settings.item_size*e.total/a*.25};this.items.selectAll(".item-circle").remove(),this.items.selectAll(".item-circle").data(n).enter().append("rect").attr("class","item item-circle").style("cursor","pointer").style("opacity",0).attr("x",function(e){return r(e)+(t.settings.item_size-l(e))/2}).attr("y",function(e){return o(e)+(t.settings.item_size-l(e))/2}).attr("rx",function(t){return l(t)}).attr("ry",function(t){return l(t)}).attr("width",function(t){return l(t)}).attr("height",function(t){return l(t)}).attr("fill",function(t){return t.total>0?s(t.total):"transparent"}).on("click",function(e){t.in_transition||0!==e.total&&(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeYearOverview(),t.overview="day",t.drawChart())}).on("mouseover",function(e){if(!t.in_transition){var i=f.select(f.event.currentTarget);!function e(){i=i.transition().duration(t.settings.transition_duration).ease(f.easeLinear).attr("x",function(e){return r(e)-(1.1*t.settings.item_size-t.settings.item_size)/2}).attr("y",function(e){return o(e)-(1.1*t.settings.item_size-t.settings.item_size)/2}).attr("width",1.1*t.settings.item_size).attr("height",1.1*t.settings.item_size).transition().duration(t.settings.transition_duration).ease(f.easeLinear).attr("x",function(e){return r(e)+(t.settings.item_size-l(e))/2}).attr("y",function(e){return o(e)+(t.settings.item_size-l(e))/2}).attr("width",function(t){return l(t)}).attr("height",function(t){return l(t)}).on("end",e)}();var n="";n+='<div class="header"><strong style="display: inline-block; width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(e.total?t.formatTime(e.total):"No time")+" tracked</strong></div>",n+="<div>on "+(0,c.default)(e.date).format("dddd, MMM Do YYYY")+"</div><br>";for(var a=0;a<e.summary.length;)n+='<div><span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><strong>'+e.summary[a].name+"</strong></span>",n+='<span style="display: inline-block; width: 50%; padding-right: 10px; box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+t.formatTime(e.summary[a].value)+"</span></div>",a++;var s=r(e)+t.settings.item_size;t.settings.width-s<t.settings.tooltip_width+3*t.settings.tooltip_padding&&(s-=t.settings.tooltip_width+2*t.settings.tooltip_padding);var d=o(e)+t.settings.item_size;t.tooltip.html(n).style("left",s+"px").style("top",d+"px").transition().duration(t.settings.transition_duration/2).ease(f.easeLinear).style("opacity",1)}}).on("mouseout",function(){t.in_transition||(f.select(f.event.currentTarget).transition().duration(t.settings.transition_duration/2).ease(f.easeLinear).attr("x",function(e){return r(e)+(t.settings.item_size-l(e))/2}).attr("y",function(e){return o(e)+(t.settings.item_size-l(e))/2}).attr("width",function(t){return l(t)}).attr("height",function(t){return l(t)}),t.hideTooltip())}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.settings.transition_duration}).duration(function(){return t.settings.transition_duration}).ease(f.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var i=0;t.each(function(){return++i}).on("end",function(){--i||e.apply(this,arguments)})},function(){t.in_transition=!1});var d=f.timeMonths(e,i),u=f.scaleLinear().range([0,this.settings.width]).domain([0,d.length]);this.labels.selectAll(".label-month").remove(),this.labels.selectAll(".label-month").data(d).enter().append("text").attr("class","label label-month").style("cursor","pointer").style("fill","rgb(170, 170, 170)").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return t.toLocaleDateString("en-us",{month:"short"})}).attr("x",function(t,e){return u(e)+(u(e)-u(e-1))/2}).attr("y",this.settings.label_padding/2).on("mouseenter",function(e){if(!t.in_transition){var i=(0,c.default)(e);t.items.selectAll(".item-circle").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).isSame(i,"month")?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-circle").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",1)}).on("click",function(e){if(!t.in_transition){t.props.data.filter(function(t){return(0,c.default)(e).startOf("month")<=(0,c.default)(t.date)&&(0,c.default)(t.date)<(0,c.default)(e).endOf("month")}).length&&(t.selected={date:e},t.in_transition=!0,t.hideTooltip(),t.removeYearOverview(),t.overview="month",t.drawChart())}});var h=f.timeDays((0,c.default)().startOf("week"),(0,c.default)().endOf("week")),p=f.scaleBand().rangeRound([this.settings.label_padding,this.settings.height]).domain(h.map(function(t){return(0,c.default)(t).weekday()}));this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-day").data(h).enter().append("text").attr("class","label label-day").style("cursor","pointer").style("fill","rgb(170, 170, 170)").attr("x",this.settings.label_padding/3).attr("y",function(t,e){return p(e)+p.bandwidth()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return(0,c.default)(t).format("dddd")[0]}).on("mouseenter",function(e){if(!t.in_transition){var i=(0,c.default)(e);t.items.selectAll(".item-circle").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).day()===i.day()?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-circle").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",1)}),this.drawButton()}},{key:"drawMonthOverview",value:function(){var t=this;this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview);for(var e=(0,c.default)(this.selected.date).startOf("month"),i=(0,c.default)(this.selected.date).endOf("month"),n=this.props.data.filter(function(t){return e<=(0,c.default)(t.date)&&(0,c.default)(t.date)<i}),a=f.max(n,function(t){return f.max(t.summary,function(t){return t.value})}),s=f.timeDays((0,c.default)().startOf("week"),(0,c.default)().endOf("week")),r=f.scaleBand().rangeRound([this.settings.label_padding,this.settings.height]).domain(s.map(function(t){return(0,c.default)(t).weekday()})),o=[e.clone()];e.week()!==i.week();)o.push(e.add(1,"week").clone());var l=f.scaleBand().rangeRound([this.settings.label_padding,this.settings.width]).padding([.05]).domain(o.map(function(t){return t.week()}));this.items.selectAll(".item-block-month").remove();var d=this.items.selectAll(".item-block-month").data(n).enter().append("g").attr("class","item item-block-month").style("cursor","pointer").attr("width",function(){return(t.settings.width-t.settings.label_padding)/o.length-5*t.settings.gutter}).attr("height",function(){return Math.min(r.bandwidth(),t.settings.max_block_height)}).attr("transform",function(t){return"translate("+l((0,c.default)(t.date).week())+","+(r((0,c.default)(t.date).weekday())+r.bandwidth()/1.75-15)+")"}).attr("total",function(t){return t.total}).attr("date",function(t){return t.date}).attr("offset",0).on("click",function(e){t.in_transition||0!==e.total&&(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeMonthOverview(),t.overview="day",t.drawChart())}),u=(this.settings.width-this.settings.label_padding)/o.length-5*this.settings.gutter,h=f.scaleLinear().rangeRound([0,u]),p=this.settings.item_gutter;d.selectAll(".item-block-rect").data(function(t){return t.summary}).enter().append("rect").attr("class","item item-block-rect").style("cursor","pointer").attr("x",function(t){var e=parseInt(f.select(this.parentNode).attr("total")),i=parseInt(f.select(this.parentNode).attr("offset"));return h.domain([0,e]),f.select(this.parentNode).attr("offset",i+h(t.value)),i}).attr("width",function(t){var e=parseInt(f.select(this.parentNode).attr("total"));return h.domain([0,e]),Math.max(h(t.value)-p,1)}).attr("height",function(){return Math.min(r.bandwidth(),t.settings.max_block_height)}).attr("fill",function(e){return f.scaleLinear().range(["#ffffff",t.props.color]).domain([-.15*a,a])(e.value)||"#ff4500"}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var i=f.select(f.event.currentTarget.parentNode),n=new Date(i.attr("date")),a="";a+='<div class="header"><strong style="display: inline-block; width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name+"</strong></div><br>",a+="<div><strong>"+(e.value?t.formatTime(e.value):"No time")+" tracked</strong></div>",a+="<div>on "+(0,c.default)(n).format("dddd, MMM Do YYYY")+"</div>";for(var s=l((0,c.default)(n).week())+t.settings.tooltip_padding;t.settings.width-s<t.settings.tooltip_width+3*t.settings.tooltip_padding;)s-=10;var o=r((0,c.default)(n).weekday())+2*t.settings.tooltip_padding;t.tooltip.html(a).style("left",s+"px").style("top",o+"px").transition().duration(t.settings.transition_duration/2).ease(f.easeLinear).style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.settings.transition_duration}).duration(function(){return t.settings.transition_duration}).ease(f.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var i=0;t.each(function(){return++i}).on("end",function(){--i||e.apply(this,arguments)})},function(){t.in_transition=!1}),this.labels.selectAll(".label-week").remove(),this.labels.selectAll(".label-week").data(o).enter().append("text").attr("class","label label-week").style("cursor","pointer").style("fill","rgb(170, 170, 170)").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return"Week "+t.week()}).attr("x",function(t){return l(t.week())}).attr("y",this.settings.label_padding/2).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block-month").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).week()===e.week()?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-month").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",1)}).on("click",function(e){if(!t.in_transition){t.props.data.filter(function(t){return e.startOf("week")<=(0,c.default)(t.date)&&(0,c.default)(t.date)<e.endOf("week")}).length&&(t.in_transition=!0,t.selected={date:e},t.hideTooltip(),t.removeMonthOverview(),t.overview="week",t.drawChart())}}),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-day").data(s).enter().append("text").attr("class","label label-day").style("cursor","pointer").style("fill","rgb(170, 170, 170)").attr("x",this.settings.label_padding/3).attr("y",function(t,e){return r(e)+r.bandwidth()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return(0,c.default)(t).format("dddd")[0]}).on("mouseenter",function(e){if(!t.in_transition){var i=(0,c.default)(e);t.items.selectAll(".item-block-month").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).day()===i.day()?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-month").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",1)}),this.drawButton()}},{key:"drawWeekOverview",value:function(){var t=this;this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview);var e=(0,c.default)(this.selected.date).startOf("week"),i=(0,c.default)(this.selected.date).endOf("week"),n=this.props.data.filter(function(t){return e<=(0,c.default)(t.date)&&(0,c.default)(t.date)<i}),a=f.max(n,function(t){return f.max(t.summary,function(t){return t.value})}),s=f.timeDays((0,c.default)().startOf("week"),(0,c.default)().endOf("week")),r=f.scaleBand().rangeRound([this.settings.label_padding,this.settings.height]).domain(s.map(function(t){return(0,c.default)(t).weekday()})),o=[e],l=f.scaleBand().rangeRound([this.settings.label_padding,this.settings.width]).padding([.01]).domain(o.map(function(t){return t.week()}));this.items.selectAll(".item-block-week").remove();var d=this.items.selectAll(".item-block-week").data(n).enter().append("g").attr("class","item item-block-week").style("cursor","pointer").attr("width",function(){return(t.settings.width-t.settings.label_padding)/o.length-5*t.settings.gutter}).attr("height",function(){return Math.min(r.bandwidth(),t.settings.max_block_height)}).attr("transform",function(t){return"translate("+l((0,c.default)(t.date).week())+","+(r((0,c.default)(t.date).weekday())+r.bandwidth()/1.75-15)+")"}).attr("total",function(t){return t.total}).attr("date",function(t){return t.date}).attr("offset",0).on("click",function(e){t.in_transition||0!==e.total&&(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeWeekOverview(),t.overview="day",t.drawChart())}),u=(this.settings.width-this.settings.label_padding)/o.length-5*this.settings.gutter,h=f.scaleLinear().rangeRound([0,u]),p=this.settings.item_gutter;d.selectAll(".item-block-rect").data(function(t){return t.summary}).enter().append("rect").attr("class","item item-block-rect").style("cursor","pointer").attr("x",function(t){var e=parseInt(f.select(this.parentNode).attr("total")),i=parseInt(f.select(this.parentNode).attr("offset"));return h.domain([0,e]),f.select(this.parentNode).attr("offset",i+h(t.value)),i}).attr("width",function(t){var e=parseInt(f.select(this.parentNode).attr("total"));return h.domain([0,e]),Math.max(h(t.value)-p,1)}).attr("height",function(){return Math.min(r.bandwidth(),t.settings.max_block_height)}).attr("fill",function(e){return f.scaleLinear().range(["#ffffff",t.props.color]).domain([-.15*a,a])(e.value)||"#ff4500"}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var i=f.select(f.event.currentTarget.parentNode),n=new Date(i.attr("date")),a="";a+='<div class="header"><strong style="display: inline-block; width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name+"</strong></div><br>",a+="<div><strong>"+(e.value?t.formatTime(e.value):"No time")+" tracked</strong></div>",a+="<div>on "+(0,c.default)(n).format("dddd, MMM Do YYYY")+"</div>";var s=parseInt(i.attr("total"));h.domain([0,s]);for(var o=parseInt(f.select(f.event.currentTarget).attr("x"))+h(e.value)/4+t.settings.tooltip_width/4;t.settings.width-o<t.settings.tooltip_width+3*t.settings.tooltip_padding;)o-=10;var l=r((0,c.default)(n).weekday())+1.5*t.settings.tooltip_padding;t.tooltip.html(a).style("left",o+"px").style("top",l+"px").transition().duration(t.settings.transition_duration/2).ease(f.easeLinear).style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.settings.transition_duration}).duration(function(){return t.settings.transition_duration}).ease(f.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var i=0;t.each(function(){return++i}).on("end",function(){--i||e.apply(this,arguments)})},function(){t.in_transition=!1}),this.labels.selectAll(".label-week").remove(),this.labels.selectAll(".label-week").data(o).enter().append("text").attr("class","label label-week").style("cursor","pointer").style("fill","rgb(170, 170, 170)").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return"Week "+t.week()}).attr("x",function(t){return l(t.week())}).attr("y",this.settings.label_padding/2).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block-week").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).week()===e.week()?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-week").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",1)}),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-day").data(s).enter().append("text").attr("class","label label-day").style("cursor","pointer").style("fill","rgb(170, 170, 170)").attr("x",this.settings.label_padding/3).attr("y",function(t,e){return r(e)+r.bandwidth()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return(0,c.default)(t).format("dddd")[0]}).on("mouseenter",function(e){if(!t.in_transition){var i=(0,c.default)(e);t.items.selectAll(".item-block-week").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).day()===i.day()?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-week").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",1)}),this.drawButton()}},{key:"drawDayOverview",value:function(){var t=this;this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview),Object.keys(this.selected).length||(this.selected=this.props.data[this.props.data.length-1]);var e=this.selected.summary.map(function(t){return t.name}),i=f.scaleBand().rangeRound([this.settings.label_padding,this.settings.height]).domain(e),n=f.scaleTime().range([2*this.settings.label_padding,this.settings.width]).domain([(0,c.default)(this.selected.date).startOf("day"),(0,c.default)(this.selected.date).endOf("day")]);this.items.selectAll(".item-block").remove(),this.items.selectAll(".item-block").data(this.selected.details).enter().append("rect").attr("class","item item-block").style("cursor","pointer").attr("x",function(t){return n((0,c.default)(t.date))}).attr("y",function(t){return i(t.name)+i.bandwidth()/2-15}).attr("width",function(t){var e=n(f.timeSecond.offset((0,c.default)(t.date),t.value));return Math.max(e-n((0,c.default)(t.date)),1)}).attr("height",function(){return Math.min(i.bandwidth(),t.settings.max_block_height)}).attr("fill",function(){return t.props.color}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var a="";a+='<div class="header"><strong style="display: inline-block; width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name+"</strong><div><br>",a+="<div><strong>"+(e.value?t.formatTime(e.value):"No time")+" tracked</strong></div>",a+="<div>on "+(0,c.default)(e.date).format("dddd, MMM Do YYYY HH:mm")+"</div>";for(var s=100*e.value/86400+n((0,c.default)(e.date));t.settings.width-s<t.settings.tooltip_width+3*t.settings.tooltip_padding;)s-=10;var r=i(e.name)+i.bandwidth()/2+t.settings.tooltip_padding/2;t.tooltip.html(a).style("left",s+"px").style("top",r+"px").transition().duration(t.settings.transition_duration/2).ease(f.easeLinear).style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).on("click",function(e){t.props.handler&&"function"==typeof t.props.handler&&t.props.handler(e)}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.settings.transition_duration}).duration(function(){return t.settings.transition_duration}).ease(f.easeLinear).style("opacity",.5).call(function(t,e){t.empty()&&e();var i=0;t.each(function(){return++i}).on("end",function(){--i||e.apply(this,arguments)})},function(){t.in_transition=!1});var a=f.timeHours((0,c.default)(this.selected.date).startOf("day"),(0,c.default)(this.selected.date).endOf("day")),s=f.scaleTime().range([2*this.settings.label_padding,this.settings.width]).domain([0,a.length]);this.labels.selectAll(".label-time").remove(),this.labels.selectAll(".label-time").data(a).enter().append("text").attr("class","label label-time").style("cursor","pointer").style("fill","rgb(170, 170, 170)").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return(0,c.default)(t).format("HH:mm")}).attr("x",function(t,e){return s(e)}).attr("y",this.settings.label_padding/2).on("mouseenter",function(e){if(!t.in_transition){var i=n((0,c.default)(e));t.items.selectAll(".item-block").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",function(t){var e=n((0,c.default)(t.date)),a=n((0,c.default)(t.date).add(t.value,"seconds"));return i>=e&&i<=a?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",.5)});var r=this.settings.label_padding;this.labels.selectAll(".label-project").remove(),this.labels.selectAll(".label-project").data(e).enter().append("text").attr("class","label label-project").style("cursor","pointer").style("fill","rgb(170, 170, 170)").attr("x",this.settings.gutter).attr("y",function(t){return i(t)+i.bandwidth()/2}).attr("min-height",function(){return i.bandwidth()}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return t}).each(function(){for(var t=f.select(this),e=t.node().getComputedTextLength(),i=t.text();e>1.5*r&&i.length>0;)i=i.slice(0,-1),t.text(i+"..."),e=t.node().getComputedTextLength()}).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",function(t){return t.name===e?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block").transition().duration(t.settings.transition_duration).ease(f.easeLinear).style("opacity",.5)}),this.drawButton()}},{key:"drawButton",value:function(){var t=this;this.buttons.selectAll(".button").remove();var e=this.buttons.append("g").attr("class","button button-back").style("cursor","pointer").attr("fill","transparent").style("opacity",0).style("stroke-width",2).style("stroke","rgb(170, 170, 170)").on("click",function(){t.in_transition||(t.in_transition=!0,"year"===t.overview?t.removeYearOverview():"month"===t.overview?t.removeMonthOverview():"week"===t.overview?t.removeWeekOverview():"day"===t.overview&&t.removeDayOverview(),t.history.pop(),t.overview=t.history.pop(),t.drawChart())});e.append("circle").attr("cx",this.settings.label_padding/2.25).attr("cy",this.settings.label_padding/2.5).attr("r",this.settings.item_size/2),e.append("text").attr("x",this.settings.label_padding/3.25).attr("y",this.settings.label_padding/2.5).attr("dy",function(){return Math.floor(t.settings.width/100)/3}).attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).html("&#x2190"),e.transition().duration(this.settings.transition_duration).ease(f.easeLinear).style("opacity",1)}},{key:"removeGlobalOverview",value:function(){this.items.selectAll(".item-block-year").transition().duration(this.settings.transition_duration).ease(f.easeLinear).style("opacity",0).remove(),this.labels.selectAll(".label-year").remove()}},{key:"removeYearOverview",value:function(){this.items.selectAll(".item-circle").transition().duration(this.settings.transition_duration).ease(f.easeLinear).style("opacity",0).remove(),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-month").remove(),this.hideBackButton()}},{key:"removeMonthOverview",value:function(){var t=this;this.items.selectAll(".item-block-month").selectAll(".item-block-rect").transition().duration(this.settings.transition_duration).ease(f.easeLinear).style("opacity",0).attr("x",function(e,i){return i%2==0?-t.settings.width/3:t.settings.width/3}).remove(),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-week").remove(),this.hideBackButton()}},{key:"removeWeekOverview",value:function(){var t=this;this.items.selectAll(".item-block-week").selectAll(".item-block-rect").transition().duration(this.settings.transition_duration).ease(f.easeLinear).style("opacity",0).attr("x",function(e,i){return i%2==0?-t.settings.width/3:t.settings.width/3}).remove(),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-week").remove(),this.hideBackButton()}},{key:"removeDayOverview",value:function(){var t=this;this.items.selectAll(".item-block").transition().duration(this.settings.transition_duration).ease(f.easeLinear).style("opacity",0).attr("x",function(e,i){return i%2==0?-t.settings.width/3:t.settings.width/3}).remove(),this.labels.selectAll(".label-time").remove(),this.labels.selectAll(".label-project").remove(),this.hideBackButton()}},{key:"hideTooltip",value:function(){this.tooltip.transition().duration(this.settings.transition_duration/2).ease(f.easeLinear).style("opacity",0)}},{key:"hideBackButton",value:function(){this.buttons.selectAll(".button").transition().duration(this.settings.transition_duration).ease(f.easeLinear).style("opacity",0).remove()}},{key:"formatTime",value:function(t){var e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),n="";return e>0&&(n+=1===e?"1 hour ":e+" hours "),i>0&&(n+=1===i?"1 minute":i+" minutes"),0===e&&0===i&&(n=Math.round(t)+" seconds"),n}},{key:"render",value:function(){var t=this,e={userSelect:"none",fontFamily:"Helvetica, Arial, sans-serif"};return d.default.createElement("div",{id:"calendar-heatmap",style:e,ref:function(e){t.container=e}})}}]),e}(d.default.Component);p.defaultProps={data:[],overview:"year",color:"#ff4500",handler:void 0},e.default=p,t.exports=e.default},function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e){t.exports=i}])});