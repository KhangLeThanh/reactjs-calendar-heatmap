!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("React"),require("moment"),require("d3")):"function"==typeof define&&define.amd?define(["React","moment","d3"],e):"object"==typeof exports?exports.CalendarHeatmap=e(require("React"),require("moment"),require("d3")):t.CalendarHeatmap=e(t.React,t.moment,t.d3)}(this,function(t,e,n){return function(t){function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),a=function(t){return t&&t.__esModule?t:{default:t}}(i);e.default=a.default,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(2),u=i(l),d=n(3),c=i(d),f=n(4),h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(f),m=function(t){function e(t){a(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.settings={gutter:5,item_gutter:1,width:1e3,height:200,item_size:10,label_padding:40,max_block_height:20,transition_duration:500,tooltip_width:250,tooltip_padding:15},n.in_transition=!1,n.overview=n.props.overview,n.history=["global"],n.selected={},n.calcDimensions=n.calcDimensions.bind(n),n}return r(e,t),o(e,[{key:"componentDidMount",value:function(){this.createElements(),this.parseData(),this.drawChart(),window.addEventListener("resize",this.calcDimensions)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.calcDimensions)}},{key:"createElements",value:function(){this.svg=h.select("#calendar-heatmap").append("svg").attr("class","svg"),this.items=this.svg.append("g"),this.labels=this.svg.append("g"),this.buttons=this.svg.append("g"),this.tooltip=h.select("#calendar-heatmap").append("div").attr("class","heatmap-tooltip").style("opacity",0),this.calcDimensions()}},{key:"calcDimensions",value:function(){var t=Math.round(((0,c.default)()-(0,c.default)().subtract(1,"year").startOf("week"))/864e5),e=Math.trunc(t/7),n=e+1;this.settings.width=this.container.offsetWidth<1e3?1e3:this.container.offsetWidth,this.settings.item_size=(this.settings.width-this.settings.label_padding)/n-this.settings.gutter,this.settings.height=this.settings.label_padding+7*(this.settings.item_size+this.settings.gutter),this.svg.attr("width",this.settings.width).attr("height",this.settings.height),this.props.data&&this.props.data[0].summary&&this.drawChart()}},{key:"parseData",value:function(){this.props.data&&(this.props.data[0].summary||this.props.data.map(function(t){var e=t.details.reduce(function(t,e){return t[e.name]?t[e.name].value+=e.value:t[e.name]={value:e.value},t},{}),n=Object.keys(e).map(function(t){return{name:t,value:e[t].value}});return t.summary=n.sort(function(t,e){return e.value-t.value}),t}))}},{key:"drawChart",value:function(){"global"===this.overview?this.drawGlobalOverview():"year"===this.overview?this.drawYearOverview():"month"===this.overview?this.drawMonthOverview():"week"===this.overview?this.drawWeekOverview():"day"===this.overview&&this.drawDayOverview()}},{key:"drawGlobalOverview",value:function(){var t=this;this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview);var e=(0,c.default)(this.props.data[0].date).startOf("year"),n=(0,c.default)(this.props.data[this.props.data.length-1].date).endOf("year"),i=h.timeYears(e,n).map(function(e){var n=(0,c.default)(e);return{date:n,total:t.props.data.reduce(function(t,e){return(0,c.default)(e.date).year()===n.year()&&(t+=e.total),t},0),summary:function(){var t=this.props.data.reduce(function(t,e){if((0,c.default)(e.date).year()===n.year())for(var i=0;i<e.summary.length;i++)t[e.summary[i].name]?t[e.summary[i].name].value+=e.summary[i].value:t[e.summary[i].name]={value:e.summary[i].value};return t},{});return Object.keys(t).map(function(e){return{name:e,value:t[e].value}}).sort(function(t,e){return e.value-t.value})}()}}),a=h.max(i,function(t){return t.total}),s=h.timeYears(e,n).map(function(t){return(0,c.default)(t)}),r=h.scaleBand().rangeRound([0,this.settings.width]).padding([.05]).domain(s.map(function(t){return t.year()}));this.items.selectAll(".item-block-year").remove();this.items.selectAll(".item-block-year").data(i).enter().append("rect").attr("class","item item-block-year").attr("width",function(){return(t.settings.width-t.settings.label_padding)/s.length-5*t.settings.gutter}).attr("height",function(){return t.settings.height-t.settings.label_padding}).attr("transform",function(e){return"translate("+r(e.date.year())+","+2*t.settings.tooltip_padding+")"}).attr("fill",function(e){return h.scaleLinear().range(["#ffffff",t.props.color]).domain([-.15*a,a])(e.total)||"#ff4500"}).on("click",function(e){t.in_transition||(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeGlobalOverview(),t.overview="year",t.drawChart())}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var n="";n+="<div><span><strong>Total time tracked:</strong></span>";var i=parseInt(e.total,10),a=Math.floor(i/86400);a>0&&(n+="<span>"+(1===a?"1 day":a+" days")+"</span></div>");var s=Math.floor((i-86400*a)/3600);s>0&&(n+=a>0?"<div><span></span><span>"+(1===s?"1 hour":s+" hours")+"</span></div>":"<span>"+(1===s?"1 hour":s+" hours")+"</span></div>");var o=Math.floor((i-86400*a-3600*s)/60);if(o>0&&(n+=a>0||s>0?"<div><span></span><span>"+(1===o?"1 minute":o+" minutes")+"</span></div>":"<span>"+(1===o?"1 minute":o+" minutes")+"</span></div>"),n+="<br />",e.summary.length<=5)for(var l=0;l<e.summary.length;l++)n+="<div><span><strong>"+e.summary[l].name+"</strong></span>",n+="<span>"+t.formatTime(e.summary[l].value)+"</span></div>";else{for(var l=0;l<5;l++)n+="<div><span><strong>"+e.summary[l].name+"</strong></span>",n+="<span>"+t.formatTime(e.summary[l].value)+"</span></div>";n+="<br />";for(var u=0,l=5;l<e.summary.length;l++)u=+e.summary[l].value;n+="<div><span><strong>Other:</strong></span>",n+="<span>"+t.formatTime(u)+"</span></div>"}for(var d=r(e.date.year())+2*t.settings.tooltip_padding;t.settings.width-d<t.settings.tooltip_width+5*t.settings.tooltip_padding;)d-=10;var c=3*t.settings.tooltip_padding;t.tooltip.html(n).style("left",d+"px").style("top",c+"px").transition().duration(t.settings.transition_duration/2).ease(h.easeLinear).style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).transition().delay(function(e,n){return t.settings.transition_duration*(n+1)/10}).duration(function(){return t.settings.transition_duration}).ease(h.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var n=0;t.each(function(){++n}).on("end",function(){--n||e.apply(this,arguments)})},function(){t.in_transition=!1});this.labels.selectAll(".label-year").remove(),this.labels.selectAll(".label-year").data(s).enter().append("text").attr("class","label label-year").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return t.year()}).attr("x",function(t){return r(t.year())}).attr("y",this.settings.label_padding/2).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block-year").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).year()===e.year()?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-year").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",1)}).on("click",function(e){t.in_transition||(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeGlobalOverview(),t.overview="year",t.drawChart())})}},{key:"drawYearOverview",value:function(){var t=this;this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview);var e=(0,c.default)(this.selected.date).startOf("year"),n=(0,c.default)(this.selected.date).endOf("year"),i=this.props.data.filter(function(t){return e<=(0,c.default)(t.date)&&(0,c.default)(t.date)<n}),a=h.max(i,function(t){return t.total}),s=h.scaleLinear().range(["#ffffff",this.props.color]).domain([-.15*a,a]),r=function(n){var i=(0,c.default)(n.date),a=Math.round((i-(0,c.default)(e).startOf("week"))/864e5);return Math.trunc(a/7)*(t.settings.item_size+t.settings.gutter)+t.settings.label_padding},o=function(e){return t.settings.label_padding+(0,c.default)(e.date).weekday()*(t.settings.item_size+t.settings.gutter)},l=function(e){return a<=0?t.settings.item_size:.75*t.settings.item_size+t.settings.item_size*e.total/a*.25};this.items.selectAll(".item-circle").remove(),this.items.selectAll(".item-circle").data(i).enter().append("rect").attr("class","item item-circle").style("opacity",0).attr("x",function(e){return r(e)+(t.settings.item_size-l(e))/2}).attr("y",function(e){return o(e)+(t.settings.item_size-l(e))/2}).attr("rx",function(t){return l(t)}).attr("ry",function(t){return l(t)}).attr("width",function(t){return l(t)}).attr("height",function(t){return l(t)}).attr("fill",function(t){return t.total>0?s(t.total):"transparent"}).on("click",function(e){t.in_transition||0!==e.total&&(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeYearOverview(),t.overview="day",t.drawChart())}).on("mouseover",function(e){if(!t.in_transition){var n=h.select(h.event.currentTarget);!function e(){n=n.transition().duration(t.settings.transition_duration).ease(h.easeLinear).attr("x",function(e){return r(e)-(1.1*t.settings.item_size-t.settings.item_size)/2}).attr("y",function(e){return o(e)-(1.1*t.settings.item_size-t.settings.item_size)/2}).attr("width",1.1*t.settings.item_size).attr("height",1.1*t.settings.item_size).transition().duration(t.settings.transition_duration).ease(h.easeLinear).attr("x",function(e){return r(e)+(t.settings.item_size-l(e))/2}).attr("y",function(e){return o(e)+(t.settings.item_size-l(e))/2}).attr("width",function(t){return l(t)}).attr("height",function(t){return l(t)}).on("end",e)}();var i="";i+='<div class="header"><strong>'+(e.total?t.formatTime(e.total):"No time")+" tracked</strong></div>",i+="<div>on "+(0,c.default)(e.date).format("dddd, MMM Do YYYY")+"</div><br>";for(var a=0;a<e.summary.length;a++)i+="<div><span><strong>"+e.summary[a].name+"</strong></span>",i+="<span>"+t.formatTime(e.summary[a].value)+"</span></div>";var s=r(e)+t.settings.item_size;t.settings.width-s<t.settings.tooltip_width+3*t.settings.tooltip_padding&&(s-=t.settings.tooltip_width+2*t.settings.tooltip_padding);var u=o(e)+t.settings.item_size;t.tooltip.html(i).style("left",s+"px").style("top",u+"px").transition().duration(t.settings.transition_duration/2).ease(h.easeLinear).style("opacity",1)}}).on("mouseout",function(){t.in_transition||(h.select(h.event.currentTarget).transition().duration(t.settings.transition_duration/2).ease(h.easeLinear).attr("x",function(e){return r(e)+(t.settings.item_size-l(e))/2}).attr("y",function(e){return o(e)+(t.settings.item_size-l(e))/2}).attr("width",function(t){return l(t)}).attr("height",function(t){return l(t)}),t.hideTooltip())}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.settings.transition_duration}).duration(function(){return t.settings.transition_duration}).ease(h.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var n=0;t.each(function(){++n}).on("end",function(){--n||e.apply(this,arguments)})},function(){t.in_transition=!1});var u=h.timeMonths(e,n),d=h.scaleLinear().range([0,this.settings.width]).domain([0,u.length]);this.labels.selectAll(".label-month").remove(),this.labels.selectAll(".label-month").data(u).enter().append("text").attr("class","label label-month").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return t.toLocaleDateString("en-us",{month:"short"})}).attr("x",function(t,e){return d(e)+(d(e)-d(e-1))/2}).attr("y",this.settings.label_padding/2).on("mouseenter",function(e){if(!t.in_transition){var n=(0,c.default)(e);t.items.selectAll(".item-circle").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).isSame(n,"month")?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-circle").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",1)}).on("click",function(e){if(!t.in_transition){t.props.data.filter(function(t){return(0,c.default)(e).startOf("month")<=(0,c.default)(t.date)&&(0,c.default)(t.date)<(0,c.default)(e).endOf("month")}).length&&(t.selected={date:e},t.in_transition=!0,t.hideTooltip(),t.removeYearOverview(),t.overview="month",t.drawChart())}});var f=h.timeDays((0,c.default)().startOf("week"),(0,c.default)().endOf("week")),m=h.scaleBand().rangeRound([this.settings.label_padding,this.settings.height]).domain(f.map(function(t){return(0,c.default)(t).weekday()}));this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-day").data(f).enter().append("text").attr("class","label label-day").attr("x",this.settings.label_padding/3).attr("y",function(t,e){return m(e)+m.bandwidth()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return(0,c.default)(t).format("dddd")[0]}).on("mouseenter",function(e){if(!t.in_transition){var n=(0,c.default)(e);t.items.selectAll(".item-circle").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).day()===n.day()?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-circle").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",1)}),this.drawButton()}},{key:"drawMonthOverview",value:function(){var t=this;this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview);for(var e=(0,c.default)(this.selected.date).startOf("month"),n=(0,c.default)(this.selected.date).endOf("month"),i=this.props.data.filter(function(t){return e<=(0,c.default)(t.date)&&(0,c.default)(t.date)<n}),a=h.max(i,function(t){return h.max(t.summary,function(t){return t.value})}),s=h.timeDays((0,c.default)().startOf("week"),(0,c.default)().endOf("week")),r=h.scaleBand().rangeRound([this.settings.label_padding,this.settings.height]).domain(s.map(function(t){return(0,c.default)(t).weekday()})),o=[e.clone()];e.week()!==n.week();)o.push(e.add(1,"week").clone());var l=h.scaleBand().rangeRound([this.settings.label_padding,this.settings.width]).padding([.05]).domain(o.map(function(t){return t.week()}));this.items.selectAll(".item-block-month").remove();var u=this.items.selectAll(".item-block-month").data(i).enter().append("g").attr("class","item item-block-month").attr("width",function(){return(t.settings.width-t.settings.label_padding)/o.length-5*t.settings.gutter}).attr("height",function(){return Math.min(r.bandwidth(),t.settings.max_block_height)}).attr("transform",function(t){return"translate("+l((0,c.default)(t.date).week())+","+(r((0,c.default)(t.date).weekday())+r.bandwidth()/1.75-15)+")"}).attr("total",function(t){return t.total}).attr("date",function(t){return t.date}).attr("offset",0).on("click",function(e){t.in_transition||0!==e.total&&(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeMonthOverview(),t.overview="day",t.drawChart())}),d=(this.settings.width-this.settings.label_padding)/o.length-5*this.settings.gutter,f=h.scaleLinear().rangeRound([0,d]);u.selectAll(".item-block-rect").data(function(t){return t.summary}).enter().append("rect").attr("class","item item-block-rect").attr("x",function(e){var n=parseInt(h.select(t.parentNode).attr("total")),i=parseInt(h.select(t.parentNode).attr("offset"));return f.domain([0,n]),h.select(t.parentNode).attr("offset",i+f(e.value)),i}).attr("width",function(e){var n=parseInt(h.select(t.parentNode).attr("total"));return f.domain([0,n]),Math.max(f(e.value)-t.settings.item_gutter,1)}).attr("height",function(){return Math.min(r.bandwidth(),t.settings.max_block_height)}).attr("fill",function(e){return h.scaleLinear().range(["#ffffff",t.props.color]).domain([-.15*a,a])(e.value)||"#ff4500"}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var n=new Date(h.select(t.parentNode).attr("date")),i="";i+='<div class="header"><strong>'+e.name+"</strong></div><br>",i+="<div><strong>"+(e.value?t.formatTime(e.value):"No time")+" tracked</strong></div>",i+="<div>on "+(0,c.default)(n).format("dddd, MMM Do YYYY")+"</div>";for(var a=l((0,c.default)(n).week())+t.settings.tooltip_padding;t.settings.width-a<t.settings.tooltip_width+3*t.settings.tooltip_padding;)a-=10;var s=r((0,c.default)(n).weekday())+2*t.settings.tooltip_padding;t.tooltip.html(i).style("left",a+"px").style("top",s+"px").transition().duration(t.settings.transition_duration/2).ease(h.easeLinear).style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.settings.transition_duration}).duration(function(){return t.settings.transition_duration}).ease(h.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var n=0;t.each(function(){++n}).on("end",function(){--n||e.apply(this,arguments)})},function(){t.in_transition=!1}),this.labels.selectAll(".label-week").remove(),this.labels.selectAll(".label-week").data(o).enter().append("text").attr("class","label label-week").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return"Week "+t.week()}).attr("x",function(t){return l(t.week())}).attr("y",this.settings.label_padding/2).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block-month").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).week()===e.week()?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-month").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",1)}).on("click",function(e){if(!t.in_transition){t.props.data.filter(function(t){return e.startOf("week")<=(0,c.default)(t.date)&&(0,c.default)(t.date)<e.endOf("week")}).length&&(t.in_transition=!0,t.selected={date:e},t.hideTooltip(),t.removeMonthOverview(),t.overview="week",t.drawChart())}}),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-day").data(s).enter().append("text").attr("class","label label-day").attr("x",this.settings.label_padding/3).attr("y",function(t,e){return r(e)+r.bandwidth()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return(0,c.default)(t).format("dddd")[0]}).on("mouseenter",function(e){if(!t.in_transition){var n=(0,c.default)(e);t.items.selectAll(".item-block-month").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).day()===n.day()?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-month").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",1)}),this.drawButton()}},{key:"drawWeekOverview",value:function(){var t=this;this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview);var e=(0,c.default)(this.selected.date).startOf("week"),n=(0,c.default)(this.selected.date).endOf("week"),i=this.props.data.filter(function(t){return e<=(0,c.default)(t.date)&&(0,c.default)(t.date)<n}),a=h.max(i,function(t){return h.max(t.summary,function(t){return t.value})}),s=h.timeDays((0,c.default)().startOf("week"),(0,c.default)().endOf("week")),r=h.scaleBand().rangeRound([this.settings.label_padding,this.settings.height]).domain(s.map(function(t){return(0,c.default)(t).weekday()})),o=[e],l=h.scaleBand().rangeRound([this.settings.label_padding,this.settings.width]).padding([.01]).domain(o.map(function(t){return t.week()}));this.items.selectAll(".item-block-week").remove();var u=this.items.selectAll(".item-block-week").data(i).enter().append("g").attr("class","item item-block-week").attr("width",function(){return(t.settings.width-t.settings.label_padding)/o.length-5*t.settings.gutter}).attr("height",function(){return Math.min(r.bandwidth(),t.settings.max_block_height)}).attr("transform",function(t){return"translate("+l((0,c.default)(t.date).week())+","+(r((0,c.default)(t.date).weekday())+r.bandwidth()/1.75-15)+")"}).attr("total",function(t){return t.total}).attr("date",function(t){return t.date}).attr("offset",0).on("click",function(e){t.in_transition||0!==e.total&&(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeWeekOverview(),t.overview="day",t.drawChart())}),d=(this.settings.width-this.settings.label_padding)/o.length-5*this.settings.gutter,f=h.scaleLinear().rangeRound([0,d]);u.selectAll(".item-block-rect").data(function(t){return t.summary}).enter().append("rect").attr("class","item item-block-rect").attr("x",function(e){var n=parseInt(h.select(t.parentNode).attr("total")),i=parseInt(h.select(t.parentNode).attr("offset"));return f.domain([0,n]),h.select(t.parentNode).attr("offset",i+f(e.value)),i}).attr("width",function(e){var n=parseInt(h.select(t.parentNode).attr("total"));return f.domain([0,n]),Math.max(f(e.value)-t.settings.item_gutter,1)}).attr("height",function(){return Math.min(r.bandwidth(),t.settings.max_block_height)}).attr("fill",function(e){return h.scaleLinear().range(["#ffffff",t.props.color]).domain([-.15*a,a])(e.value)||"#ff4500"}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var n=new Date(h.select(t.parentNode).attr("date")),i="";i+='<div class="header"><strong>'+e.name+"</strong></div><br>",i+="<div><strong>"+(e.value?t.formatTime(e.value):"No time")+" tracked</strong></div>",i+="<div>on "+(0,c.default)(n).format("dddd, MMM Do YYYY")+"</div>";var a=parseInt(h.select(t.parentNode).attr("total"));f.domain([0,a]);for(var s=parseInt(h.select(h.event.currentTarget).attr("x"))+f(e.value)/4+t.settings.tooltip_width/4;t.settings.width-s<t.settings.tooltip_width+3*t.settings.tooltip_padding;)s-=10;var o=r((0,c.default)(n).weekday())+1.5*t.settings.tooltip_padding;t.tooltip.html(i).style("left",s+"px").style("top",o+"px").transition().duration(t.settings.transition_duration/2).ease(h.easeLinear).style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.settings.transition_duration}).duration(function(){return t.settings.transition_duration}).ease(h.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var n=0;t.each(function(){++n}).on("end",function(){--n||e.apply(this,arguments)})},function(){t.in_transition=!1}),this.labels.selectAll(".label-week").remove(),this.labels.selectAll(".label-week").data(o).enter().append("text").attr("class","label label-week").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return"Week "+t.week()}).attr("x",function(t){return l(t.week())}).attr("y",this.settings.label_padding/2).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block-week").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).week()===e.week()?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-week").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",1)}),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-day").data(s).enter().append("text").attr("class","label label-day").attr("x",this.settings.label_padding/3).attr("y",function(t,e){return r(e)+r.bandwidth()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return(0,c.default)(t).format("dddd")[0]}).on("mouseenter",function(e){if(!t.in_transition){var n=(0,c.default)(e);t.items.selectAll(".item-block-week").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",function(t){return(0,c.default)(t.date).day()===n.day()?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-week").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",1)}),this.drawButton()}},{key:"drawDayOverview",value:function(){var t=this;this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview),Object.keys(this.selected).length||(this.selected=this.props.data[this.props.data.length-1]);var e=this.selected.summary.map(function(t){return t.name}),n=h.scaleBand().rangeRound([this.settings.label_padding,this.settings.height]).domain(e),i=h.scaleTime().range([2*this.settings.label_padding,this.settings.width]).domain([(0,c.default)(this.selected.date).startOf("day"),(0,c.default)(this.selected.date).endOf("day")]);this.items.selectAll(".item-block").remove(),this.items.selectAll(".item-block").data(this.selected.details).enter().append("rect").attr("class","item item-block").attr("x",function(t){return i((0,c.default)(t.date))}).attr("y",function(t){return n(t.name)+n.bandwidth()/2-15}).attr("width",function(t){var e=i(h.timeSecond.offset((0,c.default)(t.date),t.value));return Math.max(e-i((0,c.default)(t.date)),1)}).attr("height",function(){return Math.min(n.bandwidth(),t.settings.max_block_height)}).attr("fill",function(){return t.props.color}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var a="";a+='<div class="header"><strong>'+e.name+"</strong><div><br>",a+="<div><strong>"+(e.value?t.formatTime(e.value):"No time")+" tracked</strong></div>",a+="<div>on "+(0,c.default)(e.date).format("dddd, MMM Do YYYY HH:mm")+"</div>";for(var s=100*e.value/86400+i((0,c.default)(e.date));t.settings.width-s<t.settings.tooltip_width+3*t.settings.tooltip_padding;)s-=10;var r=n(e.name)+n.bandwidth()/2+t.settings.tooltip_padding/2;t.tooltip.html(a).style("left",s+"px").style("top",r+"px").transition().duration(t.settings.transition_duration/2).ease(h.easeLinear).style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).on("click",function(e){t.props.handler&&"function"==typeof t.props.handler&&t.props.handler(e)}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.settings.transition_duration}).duration(function(){return t.settings.transition_duration}).ease(h.easeLinear).style("opacity",.5).call(function(t,e){t.empty()&&e();var n=0;t.each(function(){++n}).on("end",function(){--n||e.apply(this,arguments)})},function(){t.in_transition=!1});var a=h.timeHours((0,c.default)(this.selected.date).startOf("day"),(0,c.default)(this.selected.date).endOf("day")),s=h.scaleTime().range([2*this.settings.label_padding,this.settings.width]).domain([0,a.length]);this.labels.selectAll(".label-time").remove(),this.labels.selectAll(".label-time").data(a).enter().append("text").attr("class","label label-time").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return(0,c.default)(t).format("HH:mm")}).attr("x",function(t,e){return s(e)}).attr("y",this.settings.label_padding/2).on("mouseenter",function(e){if(!t.in_transition){var n=i((0,c.default)(e));t.items.selectAll(".item-block").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",function(t){var e=i((0,c.default)(t.date)),a=i((0,c.default)(t.date).add(t.value,"seconds"));return n>=e&&n<=a?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",.5)}),this.labels.selectAll(".label-project").remove(),this.labels.selectAll(".label-project").data(e).enter().append("text").attr("class","label label-project").attr("x",this.settings.gutter).attr("y",function(t){return n(t)+n.bandwidth()/2}).attr("min-height",function(){return n.bandwidth()}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).text(function(t){return t}).each(function(){for(var e=h.select(t),n=e.node().getComputedTextLength(),i=e.text();n>1.5*t.settings.label_padding&&i.length>0;)i=i.slice(0,-1),e.text(i+"..."),n=e.node().getComputedTextLength()}).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",function(t){return t.name===e?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block").transition().duration(t.settings.transition_duration).ease(h.easeLinear).style("opacity",.5)}),this.drawButton()}},{key:"drawButton",value:function(){var t=this;this.buttons.selectAll(".button").remove();var e=this.buttons.append("g").attr("class","button button-back").style("opacity",0).on("click",function(){t.in_transition||(t.in_transition=!0,"year"===t.overview?t.removeYearOverview():"month"===t.overview?t.removeMonthOverview():"week"===t.overview?t.removeWeekOverview():"day"===t.overview&&t.removeDayOverview(),t.history.pop(),t.overview=t.history.pop(),t.drawChart())});e.append("circle").attr("cx",this.settings.label_padding/2.25).attr("cy",this.settings.label_padding/2.5).attr("r",this.settings.item_size/2),e.append("text").attr("x",this.settings.label_padding/2.25).attr("y",this.settings.label_padding/2.5).attr("dy",function(){return Math.floor(t.settings.width/100)/3}).attr("font-size",function(){return Math.floor(t.settings.label_padding/3)+"px"}).html("&#x2190;"),e.transition().duration(this.settings.transition_duration).ease(h.easeLinear).style("opacity",1)}},{key:"removeGlobalOverview",value:function(){this.items.selectAll(".item-block-year").transition().duration(this.settings.transition_duration).ease(h.easeLinear).style("opacity",0).remove(),this.labels.selectAll(".label-year").remove()}},{key:"removeYearOverview",value:function(){this.items.selectAll(".item-circle").transition().duration(this.settings.transition_duration).ease(h.easeLinear).style("opacity",0).remove(),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-month").remove(),this.hideBackButton()}},{key:"removeMonthOverview",value:function(){var t=this;this.items.selectAll(".item-block-month").selectAll(".item-block-rect").transition().duration(this.settings.transition_duration).ease(h.easeLinear).style("opacity",0).attr("x",function(e,n){return n%2==0?-t.settings.width/3:t.settings.width/3}).remove(),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-week").remove(),this.hideBackButton()}},{key:"removeWeekOverview",value:function(){var t=this;this.items.selectAll(".item-block-week").selectAll(".item-block-rect").transition().duration(this.settings.transition_duration).ease(h.easeLinear).style("opacity",0).attr("x",function(e,n){return n%2==0?-t.settings.width/3:t.settings.width/3}).remove(),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-week").remove(),this.hideBackButton()}},{key:"removeDayOverview",value:function(){var t=this;this.items.selectAll(".item-block").transition().duration(this.settings.transition_duration).ease(h.easeLinear).style("opacity",0).attr("x",function(e,n){return n%2==0?-t.settings.width/3:t.settings.width/3}).remove(),this.labels.selectAll(".label-time").remove(),this.labels.selectAll(".label-project").remove(),this.hideBackButton()}},{key:"hideTooltip",value:function(){this.tooltip.transition().duration(this.settings.transition_duration/2).ease(h.easeLinear).style("opacity",0)}},{key:"hideBackButton",value:function(){this.buttons.selectAll(".button").transition().duration(this.settings.transition_duration).ease(h.easeLinear).style("opacity",0).remove()}},{key:"formatTime",value:function(t){var e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60),i="";return e>0&&(i+=1===e?"1 hour ":e+" hours "),n>0&&(i+=1===n?"1 minute":n+" minutes"),0===e&&0===n&&(i=Math.round(t)+" seconds"),i}},{key:"render",value:function(){var t=this;return u.default.createElement("div",{id:"calendar-heatmap",ref:function(e){t.container=e}})}}]),e}(u.default.Component);m.defaultProps={data:[],overview:"year",color:"#ff4500",handler:void 0},e.default=m,t.exports=e.default},function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e){t.exports=n}])});